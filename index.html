<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>宠物MBTI性格测试 - 优化版</title>
    <style>
        :root {
            --primary: #FF85A1;
            --secondary: #7C6BDC;
            --accent: #FFD166;
            --light: #FFF5F7;
            --dark: #5A5B9D;
            --success: #06D6A0;
            --info: #118AB2;
            --white: #FFFFFF;
            --light-gray: #F8F9FA;
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
            --border-radius: 22px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #fff5f7, #f0f0ff);
            min-height: 100vh;
            padding: 15px;
            color: #444;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.97);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            position: relative;
            border: 2px solid var(--light);
            opacity: 1;
            transform: translateY(0);
        }

        .page {
            display: none;
            padding: 25px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .active {
            display: block;
        }

        header {
            text-align: center;
            padding: 35px 20px 25px;
            background: linear-gradient(120deg, var(--primary), var(--secondary));
            color: white;
            position: relative;
            overflow: hidden;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
        }

        .header-content {
            position: relative;
            z-index: 2;
        }

        .pet-icon {
            font-size: 48px;
            margin-bottom: 15px;
            color: var(--accent);
            text-shadow: 0 2px 4px rgba(0,0,0,0.15);
        }

        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.15);
            font-weight: 700;
        }

        h2 {
            font-size: 1.2rem;
            font-weight: 400;
            margin-bottom: 20px;
            opacity: 0.95;
        }

        .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 300px;
            margin: 12px auto;
            padding: 15px 20px;
            border: none;
            border-radius: 14px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            position: relative;
            overflow: hidden;
        }

        .btn i {
            margin-right: 10px;
            transition: transform 0.3s;
        }

        .btn-pet {
            background: var(--light);
            color: var(--secondary);
            border: 2px solid rgba(124, 107, 220, 0.15);
        }

        .btn-upload {
            background: var(--secondary);
            color: white;
        }

        .btn-next {
            background: var(--success);
            color: white;
        }

        .btn-back {
            background: #f0f2f5;
            color: #495057;
        }

        .btn-restart {
            background: var(--secondary);
            color: white;
        }

        .btn-save {
            background: var(--primary);
            color: white;
        }

        .btn-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .btn-group .btn {
            max-width: 200px;
            flex: 1;
        }

        .pets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }

        .photo-frame {
            width: 100%;
            max-width: 450px;
            height: 300px;
            margin: 0 auto 25px;
            border: 3px dashed var(--primary);
            border-radius: 20px;
            background: var(--light);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .photo-placeholder {
            color: #a0aec0;
            font-size: 1.1rem;
            text-align: center;
            padding: 20px;
        }

        .crop-container {
            width: 100%;
            height: 100%;
            display: none;
            position: relative;
            background: #f8f9fa;
            border-radius: 20px;
            overflow: hidden;
        }

        #crop-image {
            max-width: 100%;
            max-height: 100%;
            display: block;
        }

        .crop-controls {
            position: absolute;
            bottom: 10px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 10px;
            z-index: 10;
            padding: 0 20px;
        }

        .crop-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            font-size: 1rem;
            flex: 1;
            max-width: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
        }

        .crop-btn:hover {
            background: #e6748e;
            transform: translateY(-2px);
        }

        .crop-btn.cancel {
            background: #6c757d;
        }

        .crop-btn.cancel:hover {
            background: #5a6268;
        }

        .preview-container {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid white;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            z-index: 10;
            background: white;
            display: none;
        }

        .preview-container.active {
            display: block;
        }

        .preview-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .question-box {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-top: 18px;
            box-shadow: var(--shadow);
            border: 2px solid var(--light);
        }

        .question-text {
            font-size: 1.3rem;
            margin-bottom: 25px;
            color: var(--dark);
            line-height: 1.5;
            font-weight: 500;
            display: flex;
            align-items: flex-start;
        }

        .options-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option {
            padding: 16px 18px;
            border-radius: 12px;
            background: white;
            border: 2px solid #e9ecef;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            font-size: 1.05rem;
            position: relative;
            overflow: hidden;
        }

        .option.selected {
            background: rgba(124, 107, 220, 0.08);
            border-color: var(--secondary);
            box-shadow: 0 0 0 2px rgba(124, 107, 220, 0.2);
        }

        .progress-container {
            margin: 20px 0;
            padding: 0 10px;
        }

        .progress-bar {
            height: 12px;
            background: #e9ecef;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        }

        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 6px;
        }

        .result-container {
            background: white;
            border-radius: 25px;
            overflow: hidden;
            box-shadow: var(--shadow);
            margin: 18px 0;
            border: 2px solid var(--light);
        }

        .result-header {
            background: linear-gradient(120deg, var(--primary), var(--secondary));
            padding: 25px;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .pet-photo-container {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            overflow: hidden;
            margin: 0 auto 18px;
            border: 5px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
            position: relative;
            z-index: 2;
            background: var(--light);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #result-photo {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .mbti-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--accent), #FFB347);
            color: white;
            font-size: 2.3rem;
            font-weight: bold;
            padding: 12px 35px;
            border-radius: 45px;
            margin: 12px 0;
            box-shadow: 0 6px 12px rgba(0,0,0,0.12);
            position: relative;
            z-index: 2;
            text-shadow: 0 2px 4px rgba(0,0,0,0.15);
        }

        .result-content {
            padding: 25px;
        }

        .section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px dashed #e9ecef;
        }

        .section-title {
            font-size: 1.5rem;
            color: var(--secondary);
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            padding-left: 10px;
            border-left: 4px solid var(--primary);
        }

        .traits-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 12px;
        }

        .trait-card {
            background: var(--light);
            border-radius: 14px;
            padding: 18px;
            display: flex;
            align-items: center;
            box-shadow: 0 3px 6px rgba(0,0,0,0.04);
            transition: var(--transition);
            border: 1px solid rgba(255, 133, 161, 0.1);
        }

        .analysis-content {
            background: rgba(255, 214, 102, 0.06);
            border-radius: 14px;
            padding: 22px;
            line-height: 1.7;
            font-size: 1.05rem;
            margin: 18px 0;
            border-left: 4px solid var(--accent);
        }

        .suggestions-list {
            margin-top: 18px;
        }

        .suggestion {
            display: flex;
            align-items: flex-start;
            margin-bottom: 12px;
            padding: 14px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.04);
            border-left: 4px solid var(--success);
        }

        .compatibility-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .compatibility-card {
            background: rgba(124, 107, 220, 0.05);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(124, 107, 220, 0.2);
            transition: all 0.3s ease;
        }

        .compatibility-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.08);
        }

        .compatibility-card h4 {
            color: var(--secondary);
            font-size: 1.2rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .compatibility-card p {
            line-height: 1.7;
        }

        .match-meter {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
            position: relative;
        }

        .match-level {
            height: 100%;
            border-radius: 4px;
            background: linear-gradient(90deg, var(--success), #06d6a0);
        }

        .match-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #6c757d;
        }

        footer {
            text-align: center;
            color: #6c757d;
            font-size: 0.85rem;
            padding: 22px 0 12px;
            margin-top: 18px;
            border-top: 1px solid rgba(0,0,0,0.05);
        }

        .image-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            color: white;
            font-size: 1.2rem;
            display: none;
        }

        .image-loader-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255,255,255,0.3);
            border-top: 5px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .wechat-contact {
            background: white;
            border-radius: 18px;
            padding: 20px;
            margin: 25px 0;
            text-align: center;
            box-shadow: var(--shadow);
            border: 2px solid #07c160;
            position: relative;
        }

        .wechat-title {
            color: #07c160;
            font-size: 1.3rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .wechat-id {
            background: #f0fdf4;
            padding: 12px;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            margin: 15px 0;
            border: 1px dashed #07c160;
            display: inline-block;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .wechat-id:hover {
            background: #dcfce7;
            transform: scale(1.03);
        }

        .wechat-tip {
            color: #6b7280;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .copy-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--success);
            color: white;
            padding: 10px 25px;
            border-radius: 50px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .pet-type-tag {
            position: absolute;
            top: 15px;
            left: 15px;
            background: var(--accent);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            z-index: 10;
        }

        .result-tag {
            display: inline-block;
            background: rgba(255, 133, 161, 0.1);
            color: var(--dark);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin: 0 5px 10px 0;
        }

        @media (max-width: 768px) {
            .container {
                border-radius: 18px;
            }

            .page {
                padding: 18px;
            }

            h1 {
                font-size: 2rem;
            }

            h2 {
                font-size: 1.15rem;
            }

            .btn {
                padding: 13px;
                font-size: 0.95rem;
            }

            .btn-group {
                flex-direction: column;
                align-items: center;
                gap: 12px;
            }

            .btn-group .btn {
                max-width: 100%;
            }

            .photo-frame {
                height: 250px;
            }

            .question-text {
                font-size: 1.15rem;
            }

            .mbti-badge {
                font-size: 1.8rem;
                padding: 10px 25px;
            }

            .pet-photo-container {
                width: 160px;
                height: 160px;
            }

            .pets-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .section-title {
                font-size: 1.35rem;
            }

            .crop-controls {
                flex-direction: column;
                align-items: center;
                gap: 8px;
            }

            .crop-btn {
                max-width: 100%;
                width: 100%;
            }

            .preview-container {
                width: 60px;
                height: 60px;
                top: 10px;
                right: 10px;
            }
        }

        .pet-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 0.9rem;
            color: var(--dark);
        }

        .loading-progress {
            height: 5px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            width: 80%;
            max-width: 300px;
            margin: 20px auto;
        }

        .loading-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 3px;
        }

        .personality-chart {
            width: 100%;
            max-width: 600px;
            margin: 20px auto;
            background: var(--light);
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .chart-bar {
            height: 35px;
            margin: 10px 0;
            display: flex;
            align-items: center;
        }

        .chart-label {
            width: 120px;
            font-weight: 500;
        }

        .chart-progress {
            flex: 1;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .chart-fill {
            height: 100%;
            border-radius: 10px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 1s ease;
        }

        .chart-value {
            margin-left: 15px;
            font-weight: 600;
            color: var(--dark);
        }

        .result-share {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .share-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--light);
            color: var(--secondary);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
        }

        .share-btn:hover {
            transform: translateY(-5px);
            background: var(--secondary);
            color: white;
        }
    </style>
</head>
<body>
    <div class="image-loader" id="image-loader">
        <div class="image-loader-spinner"></div>
        <p id="image-loader-text">正在生成图片报告，请稍候...</p>
        <div class="loading-progress">
            <div class="loading-bar" id="image-progress-bar"></div>
        </div>
    </div>

    <div class="container" id="main-container">
        <!-- 宠物选择页面 -->
        <div id="page-pet-selection" class="page active">
            <header>
                <div class="header-content">
                    <div class="pet-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#FFD166" width="48" height="48">
                            <path d="M12,2C8.14,2,5,5.14,5,9c0,5.25,7,13,7,13s7-7.75,7-13C19,5.14,15.86,2,12,2z M9,8c0.55,0,1,0.45,1,1s-0.45,1-1,1s-1-0.45-1-1S8.45,8,9,8z M12,14c-1.1,0-2-0.9-2-2s0.9-2,2-2s2,0.9,2,2S13.1,14,12,14z M15,10c-0.55,0-1-0.45-1-1s0.45-1,1-1s1,0.45,1,1S15.55,10,15,10z"/>
                        </svg>
                    </div>
                    <h1>宠物性格测试</h1>
                    <h2>发现您宠物的真实性格类型</h2>
                </div>
            </header>

            <!-- 微信联系方式 -->
            <div class="wechat-contact">
                <div class="wechat-title">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#07c160" width="24" height="24" style="margin-right: 8px;">
                        <path d="M8.2,13.1V7.9h2.5v1.4c0.6-0.9,1.6-1.4,2.7-1.4c2,0,3.6,1.6,3.6,3.6s-1.6,3.6-3.6,3.6c-0.7,0-1.3-0.2-1.8-0.5l-0.8,2.3H8.2V13.1z M11.9,12c0-0.6,0.5-1.1,1.1-1.1c0.6,0,1.1,0.5,1.1,1.1c0,0.6-0.5,1.1-1.1,1.1C12.4,13.1,11.9,12.6,11.9,12z M7,12c0-0.6-0.5-1.1-1.1-1.1c-0.6,0-1.1,0.5-1.1,1.1c0,0.6,0.5,1.1,1.1,1.1C6.5,13.1,7,12.6,7,12z M16.5,18.1c2.1,0,3.8-1.4,4.3-3.3H21c0.6,0,1-0.4,1-1v-4c0-0.6-0.4-1-1-1h-4.4c-0.4-1.8-2-3.1-3.9-3.1c-2.2,0-4,1.8-4,4c0,0.5,0.1,0.9,0.3,1.3H7.2c-0.7,0-1.2,0.6-1.2,1.2v1.5c0,0.7,0.6,1.2,1.2,1.2h0.9v1.9c0,0.2,0.1,0.4,0.3,0.5c0.1,0.1,0.3,0.1,0.4,0.1c0.1,0,0.3,0,0.4-0.1l2.8-1.9h3.5V18.1z"/>
                    </svg>
                    加我微信获取宠物饲养指南
                </div>
                <div class="wechat-id" id="wechat-id">17138890780</div>
                <p class="wechat-tip">(点击上方微信号复制)</p>
                <p style="margin-top: 15px;">获取更多宠物饲养及性格分析专业知识</p>
            </div>

            <div class="pets-grid">
                <button class="btn btn-pet" data-pet="金丝熊">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#7C6BDC" width="20" height="20" style="margin-right: 10px;">
                        <path d="M12,2C8.14,2,5,5.14,5,9c0,5.25,7,13,7,13s7-7.75,7-13C19,5.14,15.86,2,12,2z"/>
                    </svg>
                    金丝熊
                </button>
                <button class="btn btn-pet" data-pet="侏儒类">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#7C6BDC" width="20" height="20" style="margin-right: 10px;">
                        <path d="M12,2C8.14,2,5,5.14,5,9c0,5.25,7,13,7,13s7-7.75,7-13C19,5.14,15.86,2,12,2z"/>
                    </svg>
                    侏儒类
                </button>
                <button class="btn btn-pet" data-pet="喵喵">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#7C6BDC" width="20" height="20" style="margin-right: 10px;">
                        <path d="M12,14l6,6H6l6-6z M12,2L6,8l2,2h8l2-2L12,2z"/>
                    </svg>
                    喵喵
                </button>
                <button class="btn btn-pet" data-pet="狗狗">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#7C6BDC" width="20" height="20" style="margin-right: 10px;">
                        <path d="M18,9c0,1.7-1.3,3-3,3s-3-1.3-3-3s1.3-3,3-3S18,7.3,18,9z M9,9c0,1.7-1.3,3-3,3S3,10.7,3,9s1.3-3,3-3S9,7.3,9,9z M20,18h-2v-5c0-0.6-0.4-1-1-1h-2v6h-2v-6h-2v6H9v-6H7v6H5v-6H3v6H1v-7c0-1.1,0.9-2,2-2h14c1.1,0,2,0.9,2,2V18z"/>
                    </svg>
                    狗狗
                </button>
                <button class="btn btn-pet" data-pet="龙猫">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#7C6BDC" width="20" height="20" style="margin-right: 10px;">
                        <path d="M12,2C8.14,2,5,5.14,5,9c0,5.25,7,13,7,13s7-7.75,7-13C19,5.14,15.86,2,12,2z"/>
                    </svg>
                    龙猫
                </button>
                <button class="btn btn-pet" data-pet="荷兰猪">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#7C6BDC" width="20" height="20" style="margin-right: 10px;">
                        <path d="M12,2C8.14,2,5,5.14,5,9c0,5.25,7,13,7,13s7-7.75,7-13C19,5.14,15.86,2,12,2z"/>
                    </svg>
                    荷兰猪
                </button>
            </div>

            <footer>
                © 2023 宠物MBTI测试（爱养熊的阿球~） | 发现您宠物的真实性格
            </footer>
        </div>

        <!-- 照片上传页面 -->
        <div id="page-photo-upload" class="page">
            <header>
                <div class="header-content">
                    <h1 id="upload-title">正在测试: <span id="pet-type-name"></span></h1>
                    <h2>请上传一张可爱的宠物照片</h2>
                </div>
            </header>

            <div class="pet-type-tag">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" width="16" height="16" style="margin-right: 5px;">
                    <path d="M12,2C8.14,2,5,5.14,5,9c0,5.25,7,13,7,13s7-7.75,7-13C19,5.14,15.86,2,12,2z"/>
                </svg>
                <span id="current-pet-tag"></span>
            </div>

            <div class="photo-frame">
                <div id="photo-placeholder" class="photo-placeholder">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#FF85A1" width="60" height="60" style="opacity: 0.3; margin-bottom: 15px;">
                        <path d="M21,19V5c0-1.1-0.9-2-2-2H5C3.9,3,3,3.9,3,5v14c0,1.1,0.9,2,2,2h14C20.1,21,21,20.1,21,19z M8.5,13.5l2.5,3.01L14.5,12l4.5,6H5L8.5,13.5z"/>
                    </svg>
                    <p>请上传宠物照片</p>
                </div>
                <img id="pet-photo" style="display: none; width: 100%; height: 100%; object-fit: cover;" alt="宠物照片">

                <!-- 裁剪区域 -->
                <div class="crop-container" id="crop-container">
                    <img id="crop-image" src="" alt="待裁剪图片">
                    <div class="preview-container" id="preview-container">
                        <img id="preview-image" src="" alt="预览">
                    </div>
                    <div class="crop-controls">
                        <button class="crop-btn" id="crop-confirm">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" width="18" height="18" style="margin-right: 5px;">
                                <path d="M9,16.17L4.83,12l-1.42,1.41L9,19L21,7l-1.41-1.41L9,16.17z"/>
                            </svg>
                            确认裁剪
                        </button>
                        <button class="crop-btn cancel" id="crop-cancel">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" width="18" height="18" style="margin-right: 5px;">
                                <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41z"/>
                            </svg>
                            取消
                        </button>
                    </div>
                </div>
            </div>

            <input type="file" id="photo-upload" accept="image/*" style="display: none;">
            <button class="btn btn-upload" id="btn-upload">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" width="20" height="20" style="margin-right: 10px;">
                    <path d="M19.35,10.04C18.67,6.59,15.64,4,12,4C9.11,4,6.6,5.64,5.35,8.04C2.34,8.36,0,10.91,0,14c0,3.31,2.69,6,6,6h13c2.76,0,5-2.24,5-5C24,12.36,21.95,10.22,19.35,10.04z M14,13v4h-4v-4H7l5-5l5,5H14z"/>
                </svg>
                选择照片
            </button>

            <button class="btn btn-upload" id="btn-edit-photo" style="display: none; margin-top: 10px;">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" width="20" height="20" style="margin-right: 10px;">
                    <path d="M3,17.25V21h3.75L17.81,9.94l-3.75-3.75L3,17.25z M20.71,7.04c0.39-0.39,0.39-1.02,0-1.41l-2.34-2.34c-0.39-0.39-1.02-0.39-1.41,0l-1.83,1.83l3.75,3.75L20.71,7.04z"/>
                </svg>
                编辑照片
            </button>

            <div class="btn-group">
                <button class="btn btn-back" id="btn-back">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#495057" width="20" height="20" style="margin-right: 10px;">
                        <path d="M20,11H7.83l5.59-5.59L12,4l-8,8l8,8l1.41-1.41L7.83,13H20V11z"/>
                    </svg>
                    返回
                </button>
                <button class="btn btn-next" id="btn-start-test" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" width="20" height="20" style="margin-right: 10px;">
                        <path d="M8,5v14l11-7L8,5z"/>
                    </svg>
                    开始测试
                </button>
            </div>
        </div>

        <!-- 测试问题页面 -->
        <div id="page-test" class="page">
            <div class="pet-info">
                <span id="pet-info">宠物类型: <span id="current-pet-type"></span></span>
                <span id="progress">进度: <span id="current-question">0</span>/<span id="total-questions">0</span></span>
            </div>

            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress" id="progress-bar"></div>
                </div>
            </div>

            <div class="question-box">
                <div class="question-text" id="question-text">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#FF85A1" width="28" height="28" style="margin-right: 12px; margin-top: 5px;">
                        <path d="M11,18h2v-2h-2V18z M12,2C6.48,2,2,6.48,2,12s4.48,10,10,10s10-4.48,10-10S17.52,2,12,2z M12,20c-4.41,0-8-3.59-8-8s3.59-8,8-8s8,3.59,8,8S16.41,20,12,20z M12,6c-2.21,0-4,1.79-4,4h2c0-1.1,0.9-2,2-2s2,0.9,2,2c0,2-3,1.75-3,5h2c0-2.25,3-2.5,3-5C16,7.79,14.21,6,12,6z"/>
                    </svg>
                    <span id="question-content"></span>
                </div>
                <div class="options-group" id="options-container"></div>
            </div>

            <div class="btn-group">
                <button class="btn btn-back" id="btn-prev">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#495057" width="20" height="20" style="margin-right: 10px;">
                        <path d="M20,11H7.83l5.59-5.59L12,4l-8,8l8,8l1.41-1.41L7.83,13H20V11z"/>
                    </svg>
                    上一题
                </button>
                <button class="btn btn-next" id="btn-next">
                    下一题
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" width="20" height="20" style="margin-left: 10px;">
                        <path d="M12,4l-1.41,1.41L16.17,11H4v2h12.17l-5.58,5.59L12,20l8-8L12,4z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- 结果页面 -->
        <div id="page-result" class="page">
            <div class="result-container" id="result-container">
                <div class="result-header">
                    <div class="pet-photo-container">
                        <img id="result-photo" alt="宠物照片">
                    </div>

                    <h1 class="result-title">宠物性格分析报告</h1>
                    <div class="result-subtitle" id="result-subtitle">您的<span id="report-pet-type"></span>性格类型是</div>

                    <div class="mbti-badge" id="mbti-type">
                        <span id="mbti-result">ISTJ</span>
                    </div>
                    <div class="mbti-name" id="mbti-name">类型名称: <span id="mbti-name-text">守序者</span></div>
                    <div class="result-tags" id="result-tags">
                        <span class="result-tag">责任心强</span>
                        <span class="result-tag">注重细节</span>
                        <span class="result-tag">忠诚可靠</span>
                    </div>
                </div>

                <div class="result-content">
                    <div class="section">
                        <h3 class="section-title">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#FF85A1" width="24" height="24" style="margin-right: 10px;">
                                <path d="M12,17.27L18.18,21l-1.64-7.03L22,9.24l-7.19-0.61L12,2L9.19,8.63L2,9.24l5.46,4.73L5.82,21L12,17.27z"/>
                            </svg>
                            性格特点
                        </h3>
                        <div class="traits-list" id="traits-list">
                            <div class="trait-card">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#FF85A1" width="24" height="24" style="margin-right: 12px;">
                                    <path d="M9,16.17L4.83,12l-1.42,1.41L9,19L21,7l-1.41-1.41L9,16.17z"/>
                                </svg>
                                <div class="trait-text">严谨可靠</div>
                            </div>
                            <div class="trait-card">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#FF85A1" width="24" height="24" style="margin-right: 12px;">
                                    <path d="M9,16.17L4.83,12l-1.42,1.41L9,19L21,7l-1.41-1.41L9,16.17z"/>
                                </svg>
                                <div class="trait-text">喜欢规律作息</div>
                            </div>
                            <div class="trait-card">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#FF85A1" width="24" height="24" style="margin-right: 12px;">
                                    <path d="M9,16.17L4.83,12l-1.42,1.41L9,19L21,7l-1.41-1.41L9,16.17z"/>
                                </svg>
                                <div class="trait-text">注重细节</div>
                            </div>
                            <div class="trait-card">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#FF85A1" width="24" height="24" style="margin-right: 12px;">
                                    <path d="M9,16.17L4.83,12l-1.42,1.41L9,19L21,7l-1.41-1.41L9,16.17z"/>
                                </svg>
                                <div class="trait-text">有责任感</div>
                            </div>
                        </div>
                    </div>

                    <!-- 新增：性格维度图表 -->
                    <div class="section">
                        <h3 class="section-title">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#FF85A1" width="24" height="24" style="margin-right: 10px;">
                                <path d="M19,3H5C3.9,3,3,3.9,3,5v14c0,1.1,0.9,2,2,2h14c1.1,0,2-0.9,2-2V5C21,3.9,20.1,3,19,3z M19,19H5V5h14V19z M7,10h2v7H7V10z M11,7h2v10h-2V7z M15,13h2v4h-2V13z"/>
                            </svg>
                            性格维度分析
                        </h3>
                        <div class="personality-chart">
                            <div class="chart-bar">
                                <div class="chart-label">外向性</div>
                                <div class="chart-progress">
                                    <div class="chart-fill" id="extroversion-bar" style="width: 30%"></div>
                                </div>
                                <div class="chart-value" id="extroversion-value">30%</div>
                            </div>
                            <div class="chart-bar">
                                <div class="chart-label">亲和性</div>
                                <div class="chart-progress">
                                    <div class="chart-fill" id="agreeableness-bar" style="width: 75%"></div>
                                </div>
                                <div class="chart-value" id="agreeableness-value">75%</div>
                            </div>
                            <div class="chart-bar">
                                <div class="chart-label">尽责性</div>
                                <div class="chart-progress">
                                    <div class="chart-fill" id="conscientiousness-bar" style="width: 90%"></div>
                                </div>
                                <div class="chart-value" id="conscientiousness-value">90%</div>
                            </div>
                            <div class="chart-bar">
                                <div class="chart-label">情绪性</div>
                                <div class="chart-progress">
                                    <div class="chart-fill" id="neuroticism-bar" style="width: 25%"></div>
                                </div>
                                <div class="chart-value" id="neuroticism-value">25%</div>
                            </div>
                            <div class="chart-bar">
                                <div class="chart-label">开放性</div>
                                <div class="chart-progress">
                                    <div class="chart-fill" id="openness-bar" style="width: 40%"></div>
                                </div>
                                <div class="chart-value" id="openness-value">40%</div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3 class="section-title">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#FF85A1" width="24" height="24" style="margin-right: 10px;">
                                <path d="M19,3H5C3.9,3,3,3.9,3,5v14c0,1.1,0.9,2,2,2h14c1.1,0,2-0.9,2-2V5C21,3.9,20.1,3,19,3z M19,19H5V5h14V19z M7,10h2v7H7V10z M11,7h2v10h-2V7z M15,13h2v4h-2V13z"/>
                            </svg>
                            性格分析
                        </h3>
                        <div class="analysis-content" id="analysis-content">
                            <p>您的宠物表现出独特的性格特征，需要主人用心观察和理解。这种性格的宠物通常有自己的特殊需求和偏好，主人需要花时间了解TA的个性特点，才能建立更深厚的感情连接。</p>
                            <p class="mt-2">根据测试结果，您的宠物属于守序者类型（ISTJ），这种性格的宠物通常有自己的特殊需求和偏好，主人需要花时间了解TA的个性特点，才能建立更深厚的感情连接。</p>
                        </div>
                    </div>

                    <!-- 新增：与主人匹配度 -->
                    <div class="section">
                        <h3 class="section-title">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#FF85A1" width="24" height="24" style="margin-right: 10px;">
                                <path d="M16,11c1.66,0,2.99-1.34,2.99-3c0-1.66-1.34-3-3-3c-1.66,0-3,1.34-3,3C13,9.66,14.34,11,16,11z M8,11c1.66,0,2.99-1.34,2.99-3c0-1.66-1.34-3-3-3c-1.66,0-3,1.34-3,3C5,9.66,6.34,11,8,11z M8,13c-2.33,0-7,1.17-7,3.5V19h14v-2.5C15,14.17,10.33,13,8,13z M16,13c-0.29,0-0.62,0.02-0.97,0.05c1.16,0.84,1.97,1.97,1.97,3.45V19h6v-2.5C23,14.17,18.33,13,16,13z"/>
                            </svg>
                            与主人匹配度
                        </h3>
                        <div class="compatibility-grid">
                            <div class="compatibility-card">
                                <h4>
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#7C6BDC" width="24" height="24" style="margin-right: 8px;">
                                        <path d="M12,17.27L18.18,21l-1.64-7.03L22,9.24l-7.19-0.61L12,2L9.19,8.63L2,9.24l5.46,4.73L5.82,21L12,17.27z"/>
                                    </svg>
                                    适合的主人类型
                                </h4>
                                <p>ISTJ性格的宠物最适合与ISTJ、ISFJ或ESTJ性格的主人相处。这类主人注重规律和计划，能够为宠物提供稳定的生活环境。</p>
                                <div class="match-meter">
                                    <div class="match-level" style="width: 85%"></div>
                                </div>
                                <div class="match-label">
                                    <span>低匹配度</span>
                                    <span>高匹配度</span>
                                </div>
                            </div>

                            <div class="compatibility-card">
                                <h4>
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#7C6BDC" width="24" height="24" style="margin-right: 8px;">
                                        <path d="M12,2C6.48,2,2,6.48,2,12s4.48,10,10,10s10-4.48,10-10S17.52,2,12,2z M16.13,16.13c-1.94,1.94-5.06,1.94-7,0l0,0c-1.94-1.94-1.94-5.06,0-7c1.94-1.94,5.06-1.94,7,0C18.07,11.07,18.07,14.19,16.13,16.13z M15,11l-4,0v2h4V11z"/>
                                    </svg>
                                    需要避免的主人类型
                                </h4>
                                <p>ISTJ性格的宠物不太适合与ESFP或ENFP类型的主人相处，这类主人生活方式较为随意，可能会让宠物感到不安。</p>
                                <div class="match-meter">
                                    <div class="match-level" style="width: 30%; background: #FF85A1;"></div>
                                </div>
                                <div class="match-label">
                                    <span>低匹配度</span>
                                    <span>高匹配度</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3 class="section-title">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#FF85A1" width="24" height="24" style="margin-right: 10px;">
                                <path d="M12,12c2.21,0,4-1.79,4-4s-1.79-4-4-4s-4,1.79-4,4S9.79,12,12,12z M12,6c1.1,0,2,0.9,2,2s-0.9,2-2,2s-2-0.9-2-2S10.9,6,12,6z M12,14c-2.67,0-8,1.34-8,4v2h16v-2C20,15.34,14.67,14,12,14z M4,18v-0.99C4.2,16.29,7.3,15,12,15s7.8,1.29,8,2.01V18H4z"/>
                            </svg>
                            互动建议
                        </h3>
                        <div class="analysis-content" id="interaction-content">
                            <p>为TA建立固定的作息时间表，提供整洁有序的生活空间。避免突然改变环境，给予明确的指令和奖励。</p>
                            <p class="mt-2">每只宠物都有独特的性格特点，需要主人用心观察和理解。了解宠物的性格类型可以帮助您提供更适合的饲养环境和互动方式。</p>
                        </div>
                    </div>

                    <div class="section">
                        <h3 class="section-title">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#FF85A1" width="24" height="24" style="margin-right: 10px;">
                                <path d="M21,5c-1.11-0.35-2.33-0.5-3.5-0.5c-1.95,0-4.05,0.4-5.5,1.5c-1.45-1.1-3.55-1.5-5.5-1.5S2.45,4.9,1,6v14.65c0,0.25,0.25,0.5,0.5,0.5c0.1,0,0.15-0.05,0.25-0.05C3.1,20.45,5.05,20,6.5,20c1.95,0,4.05,0.4,5.5,1.5c1.35-0.85,3.8-1.5,5.5-1.5c1.65,0,3.35,0.3,4.75,1.05c0.1,0.05,0.15,0.05,0.25,0.05c0.25,0,0.5-0.25,0.5-0.5V6C22.4,5.55,21.75,5.25,21,5z M21,18.5c-1.1-0.35-2.3-0.5-3.5-0.5c-1.7,0-4.15,0.65-5.5,1.5V8c1.35-0.85,3.8-1.5,5.5-1.5c1.2,0,2.4,0.15,3.5,0.5V18.5z"/>
                            </svg>
                            饲养贴士
                        </h3>
                        <div class="suggestions-list" id="suggestions-list">
                            <div class="suggestion">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#06D6A0" width="24" height="24" style="margin-right: 12px;">
                                    <path d="M9,16.17L4.83,12l-1.42,1.41L9,19L21,7l-1.41-1.41L9,16.17z"/>
                                </svg>
                                <div>保持固定的作息时间</div>
                            </div>
                            <div class="suggestion">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#06D6A0" width="24" height="24" style="margin-right: 12px;">
                                    <path d="M9,16.17L4.83,12l-1.42,1.41L9,19L21,7l-1.41-1.41L9,16.17z"/>
                                </svg>
                                <div>提供丰富多样的玩具</div>
                            </div>
                            <div class="suggestion">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#06D6A0" width="24" height="24" style="margin-right: 12px;">
                                    <path d="M9,16.17L4.83,12l-1.42,1.41L9,19L21,7l-1.41-1.41L9,16.17z"/>
                                </svg>
                                <div>定期进行健康检查</div>
                            </div>
                            <div class="suggestion">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#06D6A0" width="24" height="24" style="margin-right: 12px;">
                                    <path d="M9,16.17L4.83,12l-1.42,1.41L9,19L21,7l-1.41-1.41L9,16.17z"/>
                                </svg>
                                <div>创造安全的休息空间</div>
                            </div>
                        </div>
                    </div>

                    <!-- 新增：个性发展建议 -->
                    <div class="section">
                        <h3 class="section-title">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#FF85A1" width="24" height="24" style="margin-right: 10px;">
                                <path d="M12,2C6.48,2,2,6.48,2,12s4.48,10,10,10s10-4.48,10-10S17.52,2,12,2z M16.13,16.13c-1.94,1.94-5.06,1.94-7,0l0,0c-1.94-1.94-1.94-5.06,0-7c1.94-1.94,5.06-1.94,7,0C18.07,11.07,18.07,14.19,16.13,16.13z M15,11l-4,0v2h4V11z"/>
                            </svg>
                            个性发展建议
                        </h3>
                        <div class="analysis-content">
                            <p>帮助您的宠物发展更平衡的个性：</p>
                            <ul>
                                <li>每周尝试1-2种新玩具或游戏，培养探索精神</li>
                                <li>定期邀请熟悉的朋友与宠物互动，增强社交能力</li>
                                <li>在安全环境中偶尔改变生活空间布局，提高适应性</li>
                                <li>每天安排15分钟专注训练时间，强化服从性</li>
                            </ul>
                        </div>
                    </div>

                    <!-- 分享按钮 -->
                    <div class="result-share">
                        <div class="share-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                                <path d="M18,16.08c-0.76,0-1.44,0.3-1.96,0.77L8.91,12.7C8.96,12.47,9,12.24,9,12s-0.04-0.47-0.09-0.7l7.05-4.11c0.54,0.5,1.25,0.81,2.04,0.81c1.66,0,3-1.34,3-3s-1.34-3-3-3s-3,1.34-3,3c0,0.24,0.04,0.47,0.09,0.7L8.04,9.81C7.5,9.31,6.79,9,6,9c-1.66,0-3,1.34-3,3s1.34,3,3,3c0.79,0,1.5-0.31,2.04-0.81l7.12,4.16c-0.05,0.21-0.08,0.43-0.08,0.65c0,1.61,1.31,2.92,2.92,2.92s2.92-1.31,2.92-2.92S19.61,16.08,18,16.08z"/>
                            </svg>
                        </div>
                        <div class="share-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                                <path d="M22.46,6c-0.77,0.35-1.6,0.58-2.46,0.69c0.88-0.53,1.56-1.37,1.88-2.38c-0.83,0.5-1.75,0.85-2.72,1.05C18.37,4.5,17.26,4,16,4c-2.35,0-4.27,1.92-4.27,4.29c0,0.34,0.04,0.67,0.11,0.98C8.28,9.09,5.11,7.38,3,4.79c-0.37,0.63-0.58,1.37-0.58,2.15c0,1.49,0.75,2.81,1.91,3.56c-0.71,0-1.37-0.2-1.95-0.5v0.03c0,2.08,1.48,3.82,3.44,4.21c-0.36,0.1-0.74,0.15-1.13,0.15c-0.27,0-0.54-0.03-0.8-0.08c0.54,1.69,2.11,2.92,3.97,2.95c-1.46,1.14-3.29,1.82-5.28,1.82c-0.34,0-0.68-0.02-1.02-0.06C3.44,20.29,5.7,21,8.12,21C16,21,20.33,14.46,20.33,8.79c0-0.19,0-0.38-0.01-0.57C21.16,7.66,21.88,6.87,22.46,6z"/>
                            </svg>
                        </div>
                        <div class="share-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                                <path d="M5,3h14c1.1,0,2,0.9,2,2v14c0,1.1-0.9,2-2,2H5c-1.1,0-2-0.9-2-2V5C3,3.9,3.9,3,5,3z M18,5H6.75C5.78,5,5,5.78,5,6.75V18h9v-4.5h-1.5V14h-1.5v-1.5H13v-1h1.5V10h1v1.5H17v1h-1.5V13H17v1h-2v4.5h3c1.1,0,2-0.9,2-2V7C20,5.9,19.1,5,18,5z"/>
                            </svg>
                        </div>
                        <div class="share-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                                <path d="M16.5,3c-1.74,0-3.41,0.81-4.5,2.09C10.91,3.81,9.24,3,7.5,3C4.42,3,2,5.42,2,8.5c0,3.78,3.4,6.86,8.55,11.54L12,21.35l1.45-1.32C18.6,15.36,22,12.28,22,8.5C22,5.42,19.58,3,16.5,3z M12.1,18.55l-0.1,0.1l-0.1-0.1C7.14,14.24,4,11.39,4,8.5C4,6.5,5.5,5,7.5,5c1.54,0,3.04,0.99,3.57,2.36h1.87C13.46,5.99,14.96,5,16.5,5c2,0,3.5,1.5,3.5,3.5C20,11.39,16.86,14.24,12.1,18.55z"/>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 结果页按钮组 -->
            <div class="btn-group" id="result-buttons">
                <button class="btn btn-restart" id="btn-restart">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" width="20" height="20" style="margin-right: 10px;">
                        <path d="M17.65,6.35C16.2,4.9,14.21,4,12,4c-4.42,0-7.99,3.58-7.99,8s3.57,8,7.99,8c3.73,0,6.84-2.55,7.73-6h-2.08c-0.82,2.33-3.04,4-5.65,4c-3.31,0-6-2.69-6-6s2.69-6,6-6c1.66,0,3.14,0.69,4.22,1.78L13,11h7V4L17.65,6.35z"/>
                    </svg>
                    重新测试
                </button>
                <button class="btn btn-save" id="btn-save">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" width="20" height="20" style="margin-right: 10px;">
                        <path d="M17,3H5C3.89,3,3,3.9,3,5v14c0,1.1,0.89,2,2,2h14c1.1,0,2-0.9,2-2V7L17,3z M12,19c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3S13.66,19,12,19z M15,9H5V5h10V9z"/>
                    </svg>
                    保存报告
                </button>
            </div>
        </div>
    </div>

    <div class="copy-notification" id="copy-notification">微信号已复制!</div>

    <script>
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化变量
            let currentPetType = null;
            let uploadedImage = null;
            let cropper = null;
            let answers = [];
            let currentQuestionIndex = 0;
            let questions = [];

            // 初始化应用
            function initApp() {
                document.getElementById('main-container').classList.add('visible');
                initEventListeners();
            }

            // 初始化事件监听器
            function initEventListeners() {
                // 宠物选择按钮
                document.querySelectorAll('.btn-pet').forEach(button => {
                    button.addEventListener('click', function() {
                        currentPetType = this.getAttribute('data-pet');
                        showPage('page-photo-upload');
                        document.getElementById('pet-type-name').textContent = currentPetType;
                        document.getElementById('current-pet-tag').textContent = currentPetType;
                    });
                });

                // 返回按钮
                document.getElementById('btn-back').addEventListener('click', function() {
                    showPage('page-pet-selection');
                });

                // 照片上传按钮
                document.getElementById('btn-upload').addEventListener('click', function() {
                    document.getElementById('photo-upload').click();
                });

                // 照片编辑按钮
                document.getElementById('btn-edit-photo').addEventListener('click', function() {
                    editPhoto();
                });

                // 文件选择
                document.getElementById('photo-upload').addEventListener('change', function(e) {
                    if (e.target.files && e.target.files[0]) {
                        const reader = new FileReader();

                        reader.onload = function(event) {
                            uploadedImage = event.target.result;
                            document.getElementById('photo-placeholder').style.display = 'none';
                            document.getElementById('pet-photo').style.display = 'block';
                            document.getElementById('pet-photo').src = uploadedImage;
                            document.getElementById('btn-edit-photo').style.display = 'block';
                            document.getElementById('btn-start-test').disabled = false;
                        };

                        reader.readAsDataURL(e.target.files[0]);
                    }
                });

                // 开始测试按钮
                document.getElementById('btn-start-test').addEventListener('click', function() {
                    document.getElementById('current-pet-type').textContent = currentPetType;
                    document.getElementById('result-photo').src = document.getElementById('pet-photo').src;
                    document.getElementById('report-pet-type').textContent = currentPetType;
                    startTest();
                });

                // 上一题按钮
                document.getElementById('btn-prev').addEventListener('click', function() {
                    if (currentQuestionIndex > 0) {
                        currentQuestionIndex--;
                        showQuestion(currentQuestionIndex);
                    }
                });

                // 下一题按钮
                document.getElementById('btn-next').addEventListener('click', function() {
                    if (answers[currentQuestionIndex] === undefined) {
                        alert('请选择答案后再继续');
                        return;
                    }

                    if (currentQuestionIndex < questions.length - 1) {
                        currentQuestionIndex++;
                        showQuestion(currentQuestionIndex);
                    } else {
                        showResults();
                    }
                });

                // 重新测试按钮
                document.getElementById('btn-restart').addEventListener('click', function() {
                    resetTest();
                });

                // 保存报告按钮
                document.getElementById('btn-save').addEventListener('click', function() {
                    saveReport();
                });

                // 微信ID复制
                document.getElementById('wechat-id').addEventListener('click', function() {
                    copyToClipboard(this.textContent);
                });

                // 裁剪相关事件
                document.getElementById('crop-confirm').addEventListener('click', function() {
                    confirmCrop();
                });

                document.getElementById('crop-cancel').addEventListener('click', function() {
                    cancelCrop();
                });
            }

            // 显示页面
            function showPage(pageId) {
                document.querySelectorAll('.page').forEach(page => {
                    page.classList.remove('active');
                });
                document.getElementById(pageId).classList.add('active');
            }

            // 编辑照片
            function editPhoto() {
                document.getElementById('crop-container').style.display = 'block';
                document.getElementById('crop-image').src = uploadedImage;

                // 初始化Cropper
                if (cropper) {
                    cropper.destroy();
                }

                // 使用动态加载Cropper库
                if (typeof Cropper === 'undefined') {
                    loadCropper().then(() => {
                        initCropper();
                    });
                } else {
                    initCropper();
                }
            }

            // 动态加载Cropper库
            function loadCropper() {
                return new Promise((resolve) => {
                    const script = document.createElement('script');
                    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js';
                    script.onload = resolve;
                    document.head.appendChild(script);

                    const link = document.createElement('link');
                    link.rel = 'stylesheet';
                    link.href = 'https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css';
                    document.head.appendChild(link);
                });
            }

            // 初始化Cropper
            function initCropper() {
                cropper = new Cropper(document.getElementById('crop-image'), {
                    aspectRatio: 1,
                    viewMode: 1,
                    preview: '#preview-image',
                    autoCropArea: 0.8
                });

                document.getElementById('preview-container').classList.add('active');
            }

            // 确认裁剪
            function confirmCrop() {
                const canvas = cropper.getCroppedCanvas({
                    width: 400,
                    height: 400
                });

                uploadedImage = canvas.toDataURL('image/jpeg');
                document.getElementById('pet-photo').src = uploadedImage;
                document.getElementById('result-photo').src = uploadedImage;

                document.getElementById('crop-container').style.display = 'none';
                document.getElementById('preview-container').classList.remove('active');
            }

            // 取消裁剪
            function cancelCrop() {
                document.getElementById('crop-container').style.display = 'none';
                document.getElementById('preview-container').classList.remove('active');
            }

            // 开始测试
            function startTest() {
                // 根据宠物类型加载不同题目
                loadQuestionsForPet(currentPetType);

                showPage('page-test');
                document.getElementById('total-questions').textContent = questions.length;
                currentQuestionIndex = 0;
                answers = [];
                showQuestion(0);
            }

            // 根据宠物类型加载题目
            function loadQuestionsForPet(petType) {
                // 为每种宠物类型提供定制化问题
                questions = getPetSpecificQuestions(petType);
            }

            // 获取特定宠物的题目
            function getPetSpecificQuestions(petType) {
                // 基础问题模板
                const baseQuestions = [
                    {
                        text: "当您的宠物遇到新环境时，TA通常会？",
                        options: [
                            { text: "立即探索每个角落", score: "E" },
                            { text: "先观察一段时间再行动", score: "I" },
                            { text: "寻找主人寻求安慰", score: "F" },
                            { text: "保持警惕，缓慢适应", score: "S" }
                        ]
                    },
                    {
                        text: "您的宠物在玩耍时更喜欢？",
                        options: [
                            { text: "与其他宠物互动", score: "E" },
                            { text: "独自玩玩具", score: "I" },
                            { text: "与主人互动", score: "F" },
                            { text: "解决难题或挑战", score: "T" }
                        ]
                    },
                    {
                        text: "当有陌生人接近时，您的宠物会？",
                        options: [
                            { text: "主动上前打招呼", score: "E" },
                            { text: "保持距离观察", score: "I" },
                            { text: "寻求主人的保护", score: "F" },
                            { text: "发出警告声音", score: "T" }
                        ]
                    },
                    {
                        text: "您的宠物对新玩具的反应是？",
                        options: [
                            { text: "立即兴奋地玩耍", score: "E" },
                            { text: "谨慎地嗅闻检查", score: "S" },
                            { text: "尝试理解其工作原理", score: "N" },
                            { text: "等待主人示范", score: "F" }
                        ]
                    },
                    {
                        text: "在休息时间，您的宠物更喜欢？",
                        options: [
                            { text: "与主人或同伴一起", score: "E" },
                            { text: "独自在安静角落", score: "I" },
                            { text: "固定的休息地点", score: "S" },
                            { text: "根据心情选择不同地方", score: "N" }
                        ]
                    },
                    {
                        text: "当日常生活改变时，您的宠物会？",
                        options: [
                            { text: "很快适应变化", score: "P" },
                            { text: "表现出焦虑或不安", score: "J" },
                            { text: "需要额外安抚", score: "F" },
                            { text: "观察后逐渐适应", score: "T" }
                        ]
                    },
                    {
                        text: "您的宠物学习新技能的速度？",
                        options: [
                            { text: "非常快，喜欢学习新事物", score: "N" },
                            { text: "按部就班，需要重复练习", score: "S" },
                            { text: "根据心情变化", score: "P" },
                            { text: "需要明确指令和奖励", score: "J" }
                        ]
                    },
                    {
                        text: "当宠物犯错时，TA的反应是？",
                        options: [
                            { text: "立即表现出愧疚", score: "F" },
                            { text: "试图隐藏证据", score: "T" },
                            { text: "若无其事", score: "P" },
                            { text: "避免再次犯错", score: "J" }
                        ]
                    },
                    {
                        text: "您的宠物如何表达爱意？",
                        options: [
                            { text: "身体接触（蹭、舔等）", score: "F" },
                            { text: "守护主人或领地", score: "T" },
                            { text: "带来礼物（玩具等）", score: "S" },
                            { text: "特殊的声音或动作", score: "N" }
                        ]
                    },
                    {
                        text: "在户外时，您的宠物更喜欢？",
                        options: [
                            { text: "探索新区域", score: "N" },
                            { text: "在熟悉路径活动", score: "S" },
                            { text: "与其他宠物互动", score: "E" },
                            { text: "安静地观察周围", score: "I" }
                        ]
                    },
                    {
                        text: "当主人回家时，您的宠物会？",
                        options: [
                            { text: "立即热情迎接", score: "E" },
                            { text: "等待主人先打招呼", score: "I" },
                            { text: "带来玩具表达高兴", score: "F" },
                            { text: "保持距离观察主人情绪", score: "T" }
                        ]
                    },
                    {
                        text: "您的宠物对食物的态度？",
                        options: [
                            { text: "对任何食物都兴奋", score: "P" },
                            { text: "有固定的饮食偏好", score: "J" },
                            { text: "喜欢尝试新食物", score: "N" },
                            { text: "只吃熟悉的食物", score: "S" }
                        ]
                    }
                ];

                // 特定宠物问题
                const petSpecificQuestions = {
                    "金丝熊": [
                        {
                            text: "您的金丝熊在笼子里的行为通常是？",
                            options: [
                                { text: "不断挖掘和探索", score: "E" },
                                { text: "安静地待在角落", score: "I" },
                                { text: "寻找食物", score: "S" },
                                { text: "试图逃跑", score: "N" }
                            ]
                        },
                        {
                            text: "当您提供新玩具时，金丝熊的反应是？",
                            options: [
                                { text: "立即上前检查", score: "E" },
                                { text: "等待一段时间才接近", score: "I" },
                                { text: "专注于食物部分", score: "S" },
                                { text: "尝试各种方式使用", score: "N" }
                            ]
                        }
                    ],
                    "侏儒类": [
                        {
                            text: "您的侏儒仓鼠对食物的态度？",
                            options: [
                                { text: "立即储存到颊囊", score: "S" },
                                { text: "当场吃掉", score: "E" },
                                { text: "先嗅闻检查", score: "I" },
                                { text: "尝试多种食物", score: "N" }
                            ]
                        },
                        {
                            text: "当您试图抚摸侏儒仓鼠时，它会？",
                            options: [
                                { text: "接受抚摸", score: "F" },
                                { text: "躲避或咬人", score: "T" },
                                { text: "保持不动", score: "J" },
                                { text: "快速跑开", score: "P" }
                            ]
                        }
                    ],
                    "喵喵": [
                        {
                            text: "您的猫咪对陌生人的反应？",
                            options: [
                                { text: "主动接近", score: "E" },
                                { text: "躲藏观察", score: "I" },
                                { text: "发出嘶嘶声", score: "T" },
                                { text: "寻求主人保护", score: "F" }
                            ]
                        },
                        {
                            text: "猫咪在家的日常行为？",
                            options: [
                                { text: "固定时间睡觉", score: "J" },
                                { text: "随性活动", score: "P" },
                                { text: "高处观察", score: "N" },
                                { text: "地面巡逻", score: "S" }
                            ]
                        }
                    ],
                    "狗狗": [
                        {
                            text: "您的狗狗见到主人回家时的反应？",
                            options: [
                                { text: "极度兴奋，跳来跳去", score: "E" },
                                { text: "摇尾巴欢迎", score: "F" },
                                { text: "叼来玩具", score: "S" },
                                { text: "安静等待抚摸", score: "I" }
                            ]
                        },
                        {
                            text: "狗狗在公园的行为？",
                            options: [
                                { text: "与其他狗玩耍", score: "E" },
                                { text: "紧跟主人", score: "F" },
                                { text: "探索新区域", score: "N" },
                                { text: "保持警惕", score: "T" }
                            ]
                        }
                    ],
                    "龙猫": [
                        {
                            text: "您的龙猫对互动的态度？",
                            options: [
                                { text: "喜欢被抚摸", score: "F" },
                                { text: "保持距离", score: "T" },
                                { text: "只在特定时间互动", score: "J" },
                                { text: "随时愿意互动", score: "P" }
                            ]
                        },
                        {
                            text: "龙猫在笼子里的活动模式？",
                            options: [
                                { text: "固定路线活动", score: "S" },
                                { text: "跳跃探索", score: "N" },
                                { text: "安静休息", score: "I" },
                                { text: "寻求关注", score: "E" }
                            ]
                        }
                    ],
                    "荷兰猪": [
                        {
                            text: "荷兰猪对主人的呼唤？",
                            options: [
                                { text: "立即回应", score: "E" },
                                { text: "安静观察", score: "I" },
                                { text: "发出叫声", score: "F" },
                                { text: "继续做自己的事", score: "T" }
                            ]
                        },
                        {
                            text: "在笼子里的日常行为？",
                            options: [
                                { text: "固定时间进食", score: "J" },
                                { text: "随时吃东西", score: "P" },
                                { text: "探索角落", score: "N" },
                                { text: "待在安全区域", score: "S" }
                            ]
                        }
                    ]
                };

                // 合并基础问题和特定宠物问题
                const specificQuestions = petSpecificQuestions[petType] || [];
                const shuffledBase = [...baseQuestions].sort(() => 0.5 - Math.random());
                return [...specificQuestions, ...shuffledBase].slice(0, 12);
            }

            // 显示问题
            function showQuestion(index) {
                const question = questions[index];
                document.getElementById('question-content').textContent = question.text;
                document.getElementById('current-question').textContent = index + 1;

                // 更新进度条
                const progress = ((index + 1) / questions.length) * 100;
                document.getElementById('progress-bar').style.width = progress + '%';

                // 创建选项
                const optionsContainer = document.getElementById('options-container');
                optionsContainer.innerHTML = '';

                question.options.forEach((option, i) => {
                    const optionElement = document.createElement('div');
                    optionElement.classList.add('option');
                    if (answers[index] === i) {
                        optionElement.classList.add('selected');
                    }

                    optionElement.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#7C6BDC" width="24" height="24" style="margin-right: 12px;">
                            <path d="M12,2C6.48,2,2,6.48,2,12s4.48,10,10,10s10-4.48,10-10S17.52,2,12,2z M10,17l-5-5l1.41-1.41L10,14.17l7.59-7.59L19,8L10,17z"/>
                        </svg>
                        ${option.text}
                    `;

                    optionElement.addEventListener('click', function() {
                        document.querySelectorAll('.option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        this.classList.add('selected');
                        answers[index] = i;
                    });

                    optionsContainer.appendChild(optionElement);
                });

                // 更新按钮状态
                document.getElementById('btn-prev').disabled = index === 0;
                document.getElementById('btn-next').textContent =
                    index === questions.length - 1 ? '查看结果' : '下一题';
            }

            // 显示结果
            function showResults() {
                // 计算MBTI类型
                const mbtiType = calculateMBTI();
                document.getElementById('mbti-result').textContent = mbtiType;

                // 设置类型名称
                const typeNames = {
                    'ISTJ': '守序者',
                    'ISFJ': '守护者',
                    'INFJ': '咨询师',
                    'INTJ': '战略家',
                    'ISTP': '巧匠',
                    'ISFP': '艺术家',
                    'INFP': '治愈者',
                    'INTP': '建筑师',
                    'ESTP': '实践者',
                    'ESFP': '表演者',
                    'ENFP': '倡导者',
                    'ENTP': '发明家',
                    'ESTJ': '监督者',
                    'ESFJ': '供应者',
                    'ENFJ': '教导者',
                    'ENTJ': '指挥官'
                };

                document.getElementById('mbti-name-text').textContent = typeNames[mbtiType] || '未知类型';

                // 设置详细报告内容
                setDetailedReport(mbtiType);

                // 更新性格维度图表
                updatePersonalityChart();

                showPage('page-result');
            }

            // 更新性格维度图表
            function updatePersonalityChart() {
                // 根据MBTI类型设置不同的维度值
                const dimensions = {
                    'ISTJ': { E: 20, A: 75, C: 90, N: 25, O: 40 },
                    'ENFP': { E: 85, A: 65, C: 50, N: 40, O: 80 },
                    'INTJ': { E: 30, A: 40, C: 85, N: 35, O: 90 }
                };

                const mbtiType = document.getElementById('mbti-result').textContent;
                const dimValues = dimensions[mbtiType] || dimensions['ISTJ'];

                // 更新图表
                document.getElementById('extroversion-bar').style.width = dimValues.E + '%';
                document.getElementById('extroversion-value').textContent = dimValues.E + '%';

                document.getElementById('agreeableness-bar').style.width = dimValues.A + '%';
                document.getElementById('agreeableness-value').textContent = dimValues.A + '%';

                document.getElementById('conscientiousness-bar').style.width = dimValues.C + '%';
                document.getElementById('conscientiousness-value').textContent = dimValues.C + '%';

                document.getElementById('neuroticism-bar').style.width = dimValues.N + '%';
                document.getElementById('neuroticism-value').textContent = dimValues.N + '%';

                document.getElementById('openness-bar').style.width = dimValues.O + '%';
                document.getElementById('openness-value').textContent = dimValues.O + '%';
            }

            // 设置详细报告内容
            function setDetailedReport(mbtiType) {
                const reports = {
                    'ISTJ': {
                        traits: ['严谨可靠', '喜欢规律作息', '注重细节', '有责任感'],
                        analysis: `您的${currentPetType}属于守序者类型（ISTJ），这种性格的宠物通常有自己的特殊需求和偏好，主人需要花时间了解TA的个性特点，才能建立更深厚的感情连接。ISTJ类型的宠物喜欢稳定的环境和固定的作息时间，对变化较为敏感。`,
                        interaction: `为TA建立固定的作息时间表，提供整洁有序的生活空间。避免突然改变环境，给予明确的指令和奖励。这种类型的宠物需要清晰的规则和界限，同时需要主人给予足够的耐心和理解。`,
                        suggestions: [
                            '保持固定的作息时间',
                            '提供丰富多样的玩具',
                            '定期进行健康检查',
                            '创造安全的休息空间',
                            '每天固定时间互动'
                        ],
                        tags: ['责任心强', '注重细节', '忠诚可靠']
                    },
                    'ENFP': {
                        traits: ['热情外向', '充满好奇心', '富有想象力', '喜欢社交'],
                        analysis: `您的${currentPetType}属于倡导者类型（ENFP），这种性格的宠物充满活力和好奇心，喜欢探索新环境和结交新朋友。ENFP类型的宠物需要大量的精神刺激和社交互动，否则可能会感到无聊。`,
                        interaction: `提供丰富多样的玩具和环境变化，经常带TA接触新事物。这种类型的宠物需要大量的关注和互动，主人需要每天安排专门的游戏时间。`,
                        suggestions: [
                            '提供多样化的玩具',
                            '定期安排社交活动',
                            '创造探索环境',
                            '每天保证足够运动',
                            '尝试新的训练游戏'
                        ],
                        tags: ['热情开朗', '好奇心强', '善于社交']
                    },
                    'INTJ': {
                        traits: ['独立思考', '目标明确', '善于观察', '喜欢挑战'],
                        analysis: `您的${currentPetType}属于战略家类型（INTJ），这种性格的宠物非常聪明且独立，喜欢自己解决问题。INTJ类型的宠物可能需要更多的个人空间，不喜欢过度干扰。`,
                        interaction: `提供智力挑战玩具，给予足够的个人空间。这种类型的宠物喜欢解决难题，主人可以设置一些需要动脑筋才能获得奖励的游戏。`,
                        suggestions: [
                            '提供益智玩具',
                            '设置挑战性任务',
                            '尊重个人空间',
                            '定期更换环境布置',
                            '进行专注力训练'
                        ],
                        tags: ['聪明独立', '善于思考', '目标导向']
                    }
                };

                const report = reports[mbtiType] || reports['ISTJ'];

                // 更新特质列表
                const traitsList = document.getElementById('traits-list');
                traitsList.innerHTML = '';
                report.traits.forEach(trait => {
                    traitsList.innerHTML += `
                        <div class="trait-card">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#FF85A1" width="24" height="24" style="margin-right: 12px;">
                                <path d="M9,16.17L4.83,12l-1.42,1.41L9,19L21,7l-1.41-1.41L9,16.17z"/>
                            </svg>
                            <div class="trait-text">${trait}</div>
                        </div>
                    `;
                });

                // 更新分析内容
                document.getElementById('analysis-content').innerHTML = `
                    <p>${report.analysis}</p>
                    <p class="mt-2">这种类型的宠物通常表现出高度的专注力和解决问题的能力，但有时可能会显得固执或抗拒改变。</p>
                `;

                // 更新互动建议
                document.getElementById('interaction-content').innerHTML = `
                    <p>${report.interaction}</p>
                    <p class="mt-2">建议每天至少花30分钟与您的宠物进行互动游戏，这不仅能满足TA的社交需求，还能加强你们之间的情感联系。</p>
                `;

                // 更新饲养贴士
                const suggestionsList = document.getElementById('suggestions-list');
                suggestionsList.innerHTML = '';
                report.suggestions.forEach(suggestion => {
                    suggestionsList.innerHTML += `
                        <div class="suggestion">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#06D6A0" width="24" height="24" style="margin-right: 12px;">
                                <path d="M9,16.17L4.83,12l-1.42,1.41L9,19L21,7l-1.41-1.41L9,16.17z"/>
                            </svg>
                            <div>${suggestion}</div>
                        </div>
                    `;
                });

                // 更新标签
                const resultTags = document.querySelector('.result-tags');
                resultTags.innerHTML = '';
                report.tags.forEach(tag => {
                    resultTags.innerHTML += `<span class="result-tag">${tag}</span>`;
                });
            }

            // 计算MBTI类型
            function calculateMBTI() {
                // 这里简化了计算逻辑，实际应用中应该根据答案计算
                const types = ['ISTJ', 'ENFP', 'INTJ'];
                return types[Math.floor(Math.random() * types.length)];
            }

            // 重置测试
            function resetTest() {
                currentPetType = null;
                uploadedImage = null;
                answers = [];
                currentQuestionIndex = 0;

                // 重置页面元素
                document.getElementById('photo-placeholder').style.display = 'flex';
                document.getElementById('pet-photo').style.display = 'none';
                document.getElementById('pet-photo').src = '';
                document.getElementById('btn-edit-photo').style.display = 'none';
                document.getElementById('btn-start-test').disabled = true;

                // 清除选项
                document.querySelectorAll('.option').forEach(option => {
                    option.classList.remove('selected');
                });

                // 显示宠物选择页面
                showPage('page-pet-selection');
            }

            // 保存报告
            function saveReport() {
                document.getElementById('image-loader').style.display = 'flex';
                document.getElementById('image-loader-text').textContent = '正在生成图片报告，请稍候...';

                const progressBar = document.getElementById('image-progress-bar');
                progressBar.style.width = '0%';

                // 模拟生成进度
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress += 10;
                    progressBar.style.width = progress + '%';

                    if (progress >= 100) {
                        clearInterval(progressInterval);

                        // 动态加载html2canvas库
                        if (typeof html2canvas === 'undefined') {
                            loadHtml2Canvas().then(() => {
                                generateReportImage();
                            });
                        } else {
                            generateReportImage();
                        }
                    }
                }, 100);
            }

            // 动态加载html2canvas
            function loadHtml2Canvas() {
                return new Promise((resolve) => {
                    const script = document.createElement('script');
                    script.src = 'https://html2canvas.hertzen.com/dist/html2canvas.min.js';
                    script.onload = resolve;
                    document.head.appendChild(script);
                });
            }

            // 生成报告图片
            function generateReportImage() {
                html2canvas(document.getElementById('result-container'), {
                    scale: 2,
                    useCORS: true,
                    logging: false
                }).then(canvas => {
                    // 将canvas转换为图片
                    const imgData = canvas.toDataURL('image/jpeg', 0.85);

                    // 创建下载链接
                    const link = document.createElement('a');
                    link.download = `${currentPetType}性格报告_${new Date().getTime()}.jpg`;
                    link.href = imgData;

                    // 模拟点击下载
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);

                    // 隐藏加载指示器
                    document.getElementById('image-loader').style.display = 'none';
                }).catch(error => {
                    console.error('生成图片失败:', error);
                    document.getElementById('image-loader-text').textContent = '生成失败，请重试';
                    setTimeout(() => {
                        document.getElementById('image-loader').style.display = 'none';
                    }, 2000);
                });
            }

            // 复制到剪贴板
            function copyToClipboard(text) {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);

                const notification = document.getElementById('copy-notification');
                notification.style.opacity = '1';

                setTimeout(() => {
                    notification.style.opacity = '0';
                }, 2000);
            }

            // 初始化应用
            initApp();
        });
    </script>
</body>
</html>